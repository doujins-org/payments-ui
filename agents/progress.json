{
  "issues": [
    {
      "id": 1,
      "name": "Align payments-ui with doujins-billing API changes",
      "description": "The payments-ui library has several endpoints that are out of sync with the current doujins-billing API. The billing API was refactored and some endpoints changed paths, were removed, or now require different parameters. This issue tracks all required changes to align payments-ui with the billing API.\n\nReference: doujins-billing routes defined in:\n- ~/doujins-billing/internal/server/routes_public.go\n- ~/doujins-billing/internal/server/routes_admin.go\n- ~/doujins-billing/internal/server/routes_service.go",
      "tasks": [
        "=== SUBSCRIPTION ENDPOINTS (Critical - all broken) ===",
        "",
        "[x] Fix cancelSubscription: change from POST /me/subscriptions/cancel to POST /me/subscriptions/:id/cancel",
        "    - File: src/lib/client.ts:249-255",
        "    - The billing API requires subscription ID in the path",
        "    - Method signature needs to accept subscriptionId parameter",
        "    - Update: cancelSubscription(subscriptionId: string, feedback?: string)",
        "",
        "[x] Fix resumeSubscription: change from POST /me/subscriptions/resume to POST /me/subscriptions/:id/resume",
        "    - File: src/lib/client.ts:287-289",
        "    - The billing API requires subscription ID in the path",
        "    - Method signature needs to accept subscriptionId parameter",
        "    - Update: resumeSubscription(subscriptionId: string)",
        "",
        "[x] Fix changeSubscription: change from POST /me/subscriptions/change to POST /me/subscriptions/:id/change-tier",
        "    - File: src/lib/client.ts:291-295",
        "    - The billing API endpoint is /change-tier not /change",
        "    - The billing API requires subscription ID in the path",
        "    - Method signature needs to accept subscriptionId parameter",
        "    - Update: changeSubscription(subscriptionId: string, payload: ChangeSubscriptionPayload)",
        "",
        "[x] Fix updateSubscriptionPaymentMethod: change from PUT /me/subscriptions/payment-method to PUT /me/subscriptions/:id/payment-method",
        "    - File: src/lib/client.ts:276-285",
        "    - The billing API requires subscription ID in the path",
        "    - Request body should only contain payment_method_id (not subscription_id)",
        "    - Update method signature and request body accordingly",
        "",
        "=== PAYMENT METHOD ENDPOINTS ===",
        "",
        "[x] Remove activatePaymentMethod: endpoint PUT /me/payment-methods/:id/activate does not exist",
        "    - File: src/lib/client.ts:233-237",
        "    - This endpoint was never implemented in doujins-billing",
        "    - Remove the method entirely or throw 'not implemented' error",
        "    - Update any consumers of this method",
        "",
        "=== SOLANA PAY ENDPOINTS (Redesigned - standalone endpoints removed) ===",
        "",
        "[x] Remove or redesign createSolanaPayIntent: POST /solana/pay does not exist",
        "    - File: src/lib/client.ts:336-350",
        "    - The Solana Pay flow was redesigned to use checkout sessions",
        "    - New flow: POST /checkout with processor='solana' creates a checkout session",
        "    - Then GET/POST /checkout/:id/solana-pay implements Solana Pay Transaction Request spec",
        "    - Either remove this method or reimplement using checkout session flow",
        "",
        "[x] Remove or redesign getSolanaPayStatus: GET /solana/pay/:reference does not exist",
        "    - File: src/lib/client.ts:352-388",
        "    - Status should be checked via checkout session status, not standalone endpoint",
        "    - Either remove this method or reimplement using checkout session polling",
        "",
        "=== PAYMENT STATUS ENDPOINT ===",
        "",
        "[x] Remove getPaymentStatus: GET /payment/status/:id does not exist",
        "    - File: src/lib/client.ts:390-399",
        "    - This endpoint was never implemented in doujins-billing",
        "    - Remove the method entirely",
        "    - Update any consumers to use alternative status checking",
        "",
        "=== TYPE UPDATES ===",
        "",
        "[x] Update TypeScript types to match billing API response shapes",
        "    - Verified build passes with existing types",
        "    - Removed unused type imports (PaymentStatusResponse, SolanaPayQRCodeIntent, etc.)",
        "    - Existing types are compatible with billing API responses",
        "",
        "=== TESTING ===",
        "",
        "[x] Update any existing tests for changed method signatures",
        "    - Created new test file: src/lib/client.test.ts",
        "    - Tests verify correct endpoint paths with subscriptionId in URL",
        "    - Tests verify removed methods no longer exist on client",
        "    - All 12 tests pass",
        "",
        "[N/A] Add integration tests against actual billing API endpoints",
        "    - Integration tests require live billing API and are out of scope",
        "[N/A] Verify checkout flow works end-to-end with Mobius processor",
        "    - Requires live billing API connection",
        "[N/A] Verify checkout flow works end-to-end with Solana processor (new flow)",
        "    - Requires live billing API and Solana devnet connection"
      ],
      "completed": true
    }
  ]
}
